<!DOCTYPE html><html lang="bg"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Калкулатор за законна лихва</title><style>body{font-family:Arial,sans-serif;max-width:800px;margin:0 auto;padding:20px;background:#f0f0f0}.calculator{background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1)}input,button{margin:10px;padding:8px;font-size:16px}button{background:#4CAF50;color:#fff;border:none;cursor:pointer;padding:10px 20px}button:hover{background:#45a049}table{width:100%;border-collapse:collapse;margin-top:20px}th,td{border:1px solid #ddd;padding:8px;text-align:left}th{background:#f2f2f2}#result{margin-top:20px}.error{color:red;margin:10px}.clear-button{background:#f44336}.clear-button:hover{background:#d32f2f}label.checkbox-label{margin-left:10px;font-size:16px;vertical-align:middle}</style></head><body><div class="calculator"><h1>Калкулатор за законна лихва</h1><div><label for="amount">Сума (лв.):</label><input type="number" id="amount" placeholder="Въведете сума" step="0.01"/></div><div><label for="startDate">Начална дата (dd/mm/yyyy):</label><input type="text" id="startDate" placeholder="dd/mm/yyyy"/></div><div><label for="endDate">Крайна дата (dd/mm/yyyy):</label><input type="text" id="endDate" placeholder="dd/mm/yyyy"/></div><div><input type="checkbox" id="sixMonthPeriod"/><label for="sixMonthPeriod" class="checkbox-label">6-месечен период (януари и юли)</label></div><button onclick="calculateInterest()">Изчисли</button><button onclick="clearFields()" class="clear-button">Изчисти</button><div id="error" class="error"></div><div id="result"></div></div><script>const defaultOlpByDate=[{from:"2020-07-01",rate:0},{from:"2022-10-01",rate:.49},{from:"2022-11-01",rate:1.42},{from:"2022-12-01",rate:1.77},{from:"2023-01-01",rate:2.02},{from:"2023-02-01",rate:2.47},{from:"2023-03-01",rate:2.79},{from:"2023-04-01",rate:3.02},{from:"2023-05-01",rate:3.12},{from:"2023-06-01",rate:3.19},{from:"2023-07-01",rate:3.24},{from:"2023-08-01",rate:3.53},{from:"2023-09-01",rate:3.63},{from:"2023-10-01",rate:3.65},{from:"2023-11-01",rate:3.66},{from:"2023-12-01",rate:3.68},{from:"2024-01-01",rate:3.79},{from:"2024-02-01",rate:3.79},{from:"2024-03-01",rate:3.8},{from:"2024-04-01",rate:3.79},{from:"2024-05-01",rate:3.78},{from:"2024-06-01",rate:3.78},{from:"2024-07-01",rate:3.63},{from:"2024-08-01",rate:3.53},{from:"2024-09-01",rate:3.54},{from:"2024-10-01",rate:3.43},{from:"2024-11-01",rate:3.22},{from:"2024-12-01",rate:3.04},{from:"2025-01-01",rate:2.95},{from:"2025-02-01",rate:2.82},{from:"2025-03-01",rate:2.59},{from:"2025-04-01",rate:2.39},{from:"2025-05-01",rate:2.24},{from:"2025-06-01",rate:2.07},{from:"2025-07-01",rate:1.91},{from:"2025-08-01",rate:1.82}];let olpByDate=defaultOlpByDate;function parseDateFromDDMMYYYY(str){const r=/^(\d{2})\/(\d{2})\/(\d{4})$/;if(!r.test(str))return null;const[_,d,m,y]=str.match(r);return`${y}-${m.padStart(2,"0")}-${d.padStart(2,"0")}`}function isValidDateFormat(s){const r=/^(\d{2})\/(\d{2})\/(\d{4})$/;if(!r.test(s))return!1;const[_,d,m,y]=s.match(r);d=+d,m=+m,y=+y;if(m<1||m>12)return!1;if(d<1||d>daysInMonth(y,m-1))return!1;return!0}function parseDateStr(s){const[y,m,d]=s.split("-").map(Number);return{y,m:m-1,d}}function daysInMonth(y,m){const d=[31,28,31,30,31,30,31,31,30,31,30,31];return m===1&&isLeapYear(y)?29:d[m]}function isLeapYear(y){return y%4===0&&y%100!==0||y%400===0}function formatMonth(y,m){const months=["януари","февруари","март","април","май","юни","юли","август","септември","октомври","ноември","декември"];return`${months[m]} ${y} г.`}function formatDate({y,m,d}){return`${String(d).padStart(2,"0")}/${String(m+1).padStart(2,"0")}/${y}`}function dateLessThan(a,b){return a.y<b.y||a.y===b.y&&a.m<b.m||a.y===b.y&&a.m===b.m&&a.d<b.d}function nextMonth({y,m}){return m===11?{y:y+1,m:0,d:1}:{y,m:m+1,d:1}}function nextHalfYear({y,m}){return m<6?{y,m:6,d:1}:{y:y+1,m:0,d:1}}function getRateForDateObj({y,m}){const d=`${y}-${String(m+1).padStart(2,"0")}-01`;let r=olpByDate[0].rate;for(let i=0;i<olpByDate.length;i++){if(d>=olpByDate[i].from)r=olpByDate[i].rate;else break}return+(r+10).toFixed(2)}function daysBetweenDates(s,e){let d=0,c={y:s.y,m:s.m,d:s.d};while(dateLessThan(c,e)||c.y===e.y&&c.m===e.m&&c.d<=e.d){d++;c.d++;if(c.d>daysInMonth(c.y,c.m)){c.d=1;c.m++;if(c.m>11){c.m=0;c.y++}}}return d}function calculateInterestDetailed(a,s,e,h){const start=parseDateStr(s),end=parseDateStr(e);if(!dateLessThan(start,end))return[0,0,[]];let totalInterest=0,totalDays=0,details=[];if(h){let c={...start};while(dateLessThan(c,end)||c.y===end.y&&c.m===end.m&&c.d<=end.d){const y=c.y,f=c.m<6,p=f?0:6,b={...c},em=f?5:11,ed=daysInMonth(y,em),peStr=`${y}-${String(em+1).padStart(2,"0")}-${String(ed).padStart(2,"0")}`,pe=dateLessThan(end,parseDateStr(peStr))?end:parseDateStr(peStr),dd=daysBetweenDates(b,pe),r=getRateForDateObj({y,m:p}),i=a*r*dd/36000,ri=+i.toFixed(2);if(dd>0){totalDays+=dd;totalInterest+=ri;details.push({period:`${formatDate(b)}-${formatDate(pe)}`,rate:r,days:dd,interest:ri})}c=nextHalfYear(c);if(!dateLessThan(c,end)&&!(c.y===end.y&&c.m===end.m&&c.d<=end.d))break}}else{let c={...start};while(dateLessThan(c,end)||c.y===end.y&&c.m===end.m&&c.d<=end.d){const y=c.y,m=c.m,ms={y,m,d:c.d},med=daysInMonth(y,m),me=c.y===end.y&&c.m===end.m?end:{y,m,d:med},dd=daysBetweenDates(ms,me),r=getRateForDateObj({y,m}),i=a*r*dd/36000,ri=+i.toFixed(2);totalDays+=dd;totalInterest+=ri;details.push({period:formatMonth(y,m),rate:r,days:dd,interest:ri});c=nextMonth(c);if(!dateLessThan(c,end)&&!(c.y===end.y&&c.m===end.m&&c.d<=end.d))break}}return[totalInterest.toFixed(2),totalDays,details]}function calculateInterest(){const a=parseFloat(document.getElementById("amount").value),s=document.getElementById("startDate").value,e=document.getElementById("endDate").value,h=document.getElementById("sixMonthPeriod").checked,err=document.getElementById("error"),res=document.getElementById("result");err.innerHTML="",res.innerHTML="";if(isNaN(a)||a<=0){err.innerHTML="Моля, въведете валидна сума";return}if(!s||!isValidDateFormat(s)){err.innerHTML="Моля, въведете валидна начална дата (dd/mm/yyyy)";return}if(!e||!isValidDateFormat(e)){err.innerHTML="Моля, въведете валидна крайна дата (dd/mm/yyyy)";return}const sd=parseDateFromDDMMYYYY(s),ed=parseDateFromDDMMYYYY(e);if(!sd||!ed){err.innerHTML="Моля, въведете датите във формат dd/mm/yyyy";return}if(!dateLessThan(parseDateStr(sd),parseDateStr(ed))){err.innerHTML="Крайната дата трябва да бъде след началната дата";return}const[i,d,b]=calculateInterestDetailed(a,sd,ed,h);let out=`<h3>Законна лихва: ${i} лв.</h3>`;out+=`<table><tr><th>${h?"Период":"Месец"}</th><th>Лихва (%)</th><th>Дни</th><th>Начислена лихва (лв.)</th></tr>`;b.forEach(x=>{out+=`<tr><td>${x.period}</td><td>${x.rate.toFixed(2)}</td><td>${x.days}</td><td>${x.interest.toFixed(2)}</td></tr>`});out+=`</table><p><strong>Общо лихва: ${i} лв.</strong></p><p><strong>Общо дни: ${d}</strong></p>`;res.innerHTML=out}function clearFields(){document.getElementById("amount").value="";document.getElementById("startDate").value="";document.getElementById("endDate").value="";document.getElementById("sixMonthPeriod").checked=!1;document.getElementById("error").innerHTML="";document.getElementById("result").innerHTML=""}function addDateMask(i){i.addEventListener("input",function(e){let v=e.target.value.replace(/[^0-9]/g,"");if(v.length>=2)v=v.slice(0,2)+"/"+v.slice(2);if(v.length>=5)v=v.slice(0,5)+"/"+v.slice(5);if(v.length>10)v=v.slice(0,10);e.target.value=v})}addDateMask(document.getElementById("startDate"));addDateMask(document.getElementById("endDate"));</script></body></html>
