<!DOCTYPE html><html lang="bg"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Калкулатор за законна лихва</title><style>body{font-family:Arial,sans-serif;max-width:800px;margin:0 auto;padding:20px;background:#f0f0f0}.calculator{background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1)}input,button{margin:10px;padding:8px;font-size:16px}button{background:#4CAF50;color:#fff;border:none;cursor:pointer;padding:10px 20px}button:hover{background:#45a049}table{width:100%;border-collapse:collapse;margin-top:20px}th,td{border:1px solid #ddd;padding:8px;text-align:left}th{background:#f2f2f2}#result{margin-top:20px}.error{color:red;margin:10px}.clear-button{background:#f44336}.clear-button:hover{background:#d32f2f}</style></head><body><div class="calculator"><h1>Калкулатор за законна лихва</h1><div><label for="amount">Сума (лв.):</label><input type="number" id="amount" placeholder="Въведете сума" step="0.01"></div><div><label for="startDate">Начална дата (dd/mm/yyyy):</label><input type="text" id="startDate" placeholder="dd/mm/yyyy"></div><div><label for="endDate">Крайна дата (dd/mm/yyyy):</label><input type="text" id="endDate" placeholder="dd/mm/yyyy"></div><button onclick="calculateInterest()">Изчисли</button><button onclick="clearFields()" class="clear-button">Изчисти</button><div id="error" class="error"></div><div id="result"></div></div><script>const defaultOlpByDate=[{from:"2020-07-01",rate:0},{from:"2022-10-01",rate:.49},{from:"2022-11-01",rate:1.42},{from:"2022-12-01",rate:1.77},{from:"2023-01-01",rate:2.02},{from:"2023-02-01",rate:2.47},{from:"2023-03-01",rate:2.79},{from:"2023-04-01",rate:3.02},{from:"2023-05-01",rate:3.12},{from:"2023-06-01",rate:3.19},{from:"2023-07-01",rate:3.24},{from:"2023-08-01",rate:3.53},{from:"2023-09-01",rate:3.63},{from:"2023-10-01",rate:3.65},{from:"2023-11-01",rate:3.66},{from:"2023-12-01",rate:3.68},{from:"2024-01-01",rate:3.79},{from:"2024-02-01",rate:3.79},{from:"2024-03-01",rate:3.8},{from:"2024-04-01",rate:3.79},{from:"2024-05-01",rate:3.78},{from:"2024-06-01",rate:3.78},{from:"2024-07-01",rate:3.63},{from:"2024-08-01",rate:3.53},{from:"2024-09-01",rate:3.54},{from:"2024-10-01",rate:3.43},{from:"2024-11-01",rate:3.22},{from:"2024-12-01",rate:3.04},{from:"2025-01-01",rate:2.95},{from:"2025-02-01",rate:2.82},{from:"2025-03-01",rate:2.59},{from:"2025-04-01",rate:2.39},{from:"2025-05-01",rate:2.24},{from:"2025-06-01",rate:2.07},{from:"2025-07-01",rate:1.91},{from:"2025-08-01",rate:1.82}];let olpByDate=defaultOlpByDate;function parseDateFromDDMMYYYY(str){const regex=/^(\d{2})\/(\d{2})\/(\d{4})$/;if(!regex.test(str))return null;const[_,day,month,year]=str.match(regex);return`${year}-${month.padStart(2,"0")}-${day.padStart(2,"0")}`}function isValidDateFormat(str){const regex=/^(\d{2})\/(\d{2})\/(\d{4})$/;if(!regex.test(str))return false;const[_,day,month,year]=str.match(regex).map(Number);if(month<1||month>12)return false;if(day<1||day>daysInMonth(year,month-1))return false;return true}function parseDateStr(str){const[y,m,d]=str.split("-").map(Number);return{y,m:m-1,d}}function daysInMonth(y,m){return new Date(y,m+1,0).getDate()}function formatMonth(y,m){return new Date(y,m,1).toLocaleString("bg-BG",{month:"long",year:"numeric"})}function dateLessThan(a,b){return a.y<b.y||(a.y===b.y&&a.m<b.m)||(a.y===b.y&&a.m===b.m&&a.d<b.d)}function sameMonth(a,b){return a.y===b.y&&a.m===b.m}function nextMonth({y,m}){return m===11?{y:y+1,m:0,d:1}:{y,m:m+1,d:1}}function getRateForDateObj({y,m}){const compareDate=`${y}-${String(m+1).padStart(2,"0")}-01`;let lastRate=olpByDate[0].rate;for(let i=0;i<olpByDate.length;i++){if(compareDate>=olpByDate[i].from)lastRate=olpByDate[i].rate;else break}return+(lastRate+10).toFixed(2)}function calculateInterestDetailed(amount,startStr,endStr){const start=parseDateStr(startStr),end=parseDateStr(endStr);if(!dateLessThan(start,end))return[0,0,[]];let totalInterest=0,totalDays=0,current={...start},details=[];while(dateLessThan(current,end)){const y=current.y,m=current.m,monthStart={y,m,d:1},monthEndDay=daysInMonth(y,m),monthEnd={y,m,d:monthEndDay},periodStart=current,periodEnd=sameMonth(end,current)&&end.d<monthEndDay?end:monthEnd,daysDelayed=periodEnd.d-periodStart.d+1,rate=getRateForDateObj({y,m}),interest=amount*rate*daysDelayed/36000,roundedInterest=+interest.toFixed(2);totalDays+=daysDelayed;totalInterest+=roundedInterest;details.push({month:formatMonth(y,m),rate,days:daysDelayed,interest:roundedInterest});current=nextMonth(current)}return[totalInterest.toFixed(2),totalDays,details]}function calculateInterest(){const amount=parseFloat(document.getElementById("amount").value),startDateInput=document.getElementById("startDate").value,endDateInput=document.getElementById("endDate").value,errorDiv=document.getElementById("error"),resultDiv=document.getElementById("result");errorDiv.innerHTML="";resultDiv.innerHTML="";if(isNaN(amount)||amount<=0){errorDiv.innerHTML="Моля, въведете валидна сума";return}if(!startDateInput||!isValidDateFormat(startDateInput)){errorDiv.innerHTML="Моля, въведете валидна начална дата (dd/mm/yyyy)";return}if(!endDateInput||!isValidDateFormat(endDateInput)){errorDiv.innerHTML="Моля, въведете валидна крайна дата (dd/mm/yyyy)";return}const startDate=parseDateFromDDMMYYYY(startDateInput),endDate=parseDateFromDDMMYYYY(endDateInput);if(!startDate||!endDate){errorDiv.innerHTML="Моля, въведете датите във формат dd/mm/yyyy";return}if(!dateLessThan(parseDateStr(startDate),parseDateStr(endDate))){errorDiv.innerHTML="Крайната дата трябва да бъде след началната дата";return}const[interest,totalDays,breakdown]=calculateInterestDetailed(amount,startDate,endDate);let tableHTML=`<table><tr><th>Месец</th><th>Лихва (%)</th><th>Дни</th><th>Начислена лихва (лв.)</th></tr>`;breakdown.forEach(entry=>{tableHTML+=`<tr><td>${entry.month}</td><td>${entry.rate.toFixed(2)}</td><td>${entry.days}</td><td>${entry.interest.toFixed(2)}</td></tr>`});tableHTML+=`</table><p><strong>Общо лихва: ${interest} лв.</strong></p><p><strong>Общо дни: ${totalDays}</p>`;resultDiv.innerHTML=tableHTML}function addDateMask(input){input.addEventListener("input",e=>{let value=e.target.value.replace(/[^0-9]/g,"");if(value.length>=2)value=value.slice(0,2)+"/"+value.slice(2);if(value.length>=5)value=value.slice(0,5)+"/"+value.slice(5);if(value.length>10)value=value.slice(0,10);e.target.value=value})}function clearFields(){document.getElementById("amount").value="";document.getElementById("startDate").value="";document.getElementById("endDate").value="";document.getElementById("error").innerHTML="";document.getElementById("result").innerHTML=""}addDateMask(document.getElementById("startDate"));addDateMask(document.getElementById("endDate"));</script></body></html>
