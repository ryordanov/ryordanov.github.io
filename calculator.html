<!DOCTYPE html><html lang="bg"><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><title>Калкулатор за законна лихва</title><style>body {font-family: Arial, sans-serif;max-width: 800px;margin: 0 auto;padding: 20px;background: #f0f0f0;}.calculator {background: #fff;padding: 20px;border-radius: 8px;box-shadow: 0 2px 4px rgba(0, 0, 0, .1);}input,button {margin: 5px 10px 10px 0;padding: 8px;font-size: 16px;}button {background: #4CAF50;color: #fff;border: none;cursor: pointer;padding: 8px 15px;border-radius: 4px;}button:hover {background: #45a049;}table {width: 100%;border-collapse: collapse;margin-top: 20px;}th,td {border: 1px solid #ddd;padding: 8px;text-align: left;}th {background: #f2f2f2;}#result {margin-top: 20px;}.error {color: red;margin: 10px 0;}.clear-button {background: #f44336;}.clear-button:hover {background: #d32f2f;}label.checkbox-label {margin-left: 10px;font-size: 16px;vertical-align: middle;}.period-row {display: flex;align-items: center;margin-bottom: 5px;}.period-row input {width: 140px;}.period-row button.delete-period {background: #f44336;margin-left: 5px;padding: 5px 10px;font-size: 14px;border-radius: 3px;}.period-row button.delete-period:hover {background: #d32f2f;}</style></head><body><div class="calculator"><h1>Калкулатор за законна лихва</h1><h3>Периоди</h3><div id="periodsContainer"></div><button id="addPeriodBtn">Добави период</button><div><label for="endDate">Крайна дата (dd/mm/yyyy):</label><input type="text" id="endDate" placeholder="dd/mm/yyyy" /></div><div><input type="checkbox" id="sixMonthPeriod" /><label for="sixMonthPeriod" class="checkbox-label">6-месечен период (януари и юли)</label></div><button id="calculateAllBtn">Изчисли</button><button id="clearAllBtn" class="clear-button">Изчисти всички</button><div id="error" class="error"></div><div id="result"></div></div><script>const defaultOlpByDate = [{ from: "2020-07-01", rate: 0 }, { from: "2022-10-01", rate: .49 }, { from: "2022-11-01", rate: 1.42 }, { from: "2022-12-01", rate: 1.77 },{ from: "2023-01-01", rate: 2.02 }, { from: "2023-02-01", rate: 2.47 }, { from: "2023-03-01", rate: 2.79 }, { from: "2023-04-01", rate: 3.02 },{ from: "2023-05-01", rate: 3.12 }, { from: "2023-06-01", rate: 3.19 }, { from: "2023-07-01", rate: 3.24 }, { from: "2023-08-01", rate: 3.53 },{ from: "2023-09-01", rate: 3.63 }, { from: "2023-10-01", rate: 3.65 }, { from: "2023-11-01", rate: 3.66 }, { from: "2023-12-01", rate: 3.68 },{ from: "2024-01-01", rate: 3.79 }, { from: "2024-02-01", rate: 3.79 }, { from: "2024-03-01", rate: 3.8 }, { from: "2024-04-01", rate: 3.79 },{ from: "2024-05-01", rate: 3.78 }, { from: "2024-06-01", rate: 3.78 }, { from: "2024-07-01", rate: 3.63 }, { from: "2024-08-01", rate: 3.53 },{ from: "2024-09-01", rate: 3.54 }, { from: "2024-10-01", rate: 3.43 }, { from: "2024-11-01", rate: 3.22 }, { from: "2024-12-01", rate: 3.04 },{ from: "2025-01-01", rate: 2.95 }, { from: "2025-02-01", rate: 2.82 }, { from: "2025-03-01", rate: 2.59 }, { from: "2025-04-01", rate: 2.39 },{ from: "2025-05-01", rate: 2.24 }, { from: "2025-06-01", rate: 2.07 }, { from: "2025-07-01", rate: 1.91 }, { from: "2025-08-01", rate: 1.82 }];let olpByDate = defaultOlpByDate;function parseDateFromDDMMYYYY(str) {const regex = /^(\d{2})\/(\d{2})\/(\d{4})$/;if (!regex.test(str)) return null;const [_, day, month, year] = str.match(regex);return `${year}-${month.padStart(2, "0")}-${day.padStart(2, "0")}`;}function isValidDateFormat(str) {const regex = /^(\d{2})\/(\d{2})\/(\d{4})$/;if (!regex.test(str)) return false;const [_, dayStr, monthStr, yearStr] = str.match(regex);const day = Number(dayStr);const month = Number(monthStr);const year = Number(yearStr);if (month < 1 || month > 12) return false;if (day < 1 || day > daysInMonth(year, month - 1)) return false;return true;}function parseDateStr(str) {const [y, m, d] = str.split("-").map(Number);return { y, m: m - 1, d };}function daysInMonth(y, m) {const days = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];if (m === 1 && isLeapYear(y)) return 29;return days[m];}function isLeapYear(year) {return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);}function formatMonth(y, m) {const months = ["януари", "февруари", "март", "април", "май", "юни","юли", "август", "септември", "октомври", "ноември", "декември"];return `${months[m]} ${y} г.`;}function formatDate({ y, m, d }) {return `${String(d).padStart(2, "0")}/${String(m + 1).padStart(2, "0")}/${y}`;}function dateLessThan(a, b) {return a.y < b.y || (a.y === b.y && a.m < b.m) || (a.y === b.y && a.m === b.m && a.d < b.d);}function dateLessThanOrEqualTo(a, b) {return a.y < b.y || (a.y === b.y && a.m < b.m) || (a.y === b.y && a.m === b.m && a.d <= b.d);}function nextMonth({ y, m }) {return m === 11 ? { y: y + 1, m: 0, d: 1 } : { y, m: m + 1, d: 1 };}function nextHalfYear({ y, m }) {return m < 6 ? { y, m: 6, d: 1 } : { y: y + 1, m: 0, d: 1 };}function getRateForDateObj({ y, m }) {const compareDate = `${y}-${String(m + 1).padStart(2, "0")}-01`;let lastRate = olpByDate[0].rate;for (let i = 0; i < olpByDate.length; i++) {if (compareDate >= olpByDate[i].from) lastRate = olpByDate[i].rate;else break;}return +(lastRate + 10).toFixed(2);}function daysBetweenDates(start, end) {let days = 0;let current = { y: start.y, m: start.m, d: start.d };while (dateLessThan(current, end) || (current.y === end.y && current.m === end.m && current.d <= end.d)) {days++;current.d++;if (current.d > daysInMonth(current.y, current.m)) {current.d = 1;current.m++;if (current.m > 11) {current.m = 0;current.y++;}}}return days;}function calculateInterestDetailed(amount, startStr, endStr, sixMonthPeriod) {const start = parseDateStr(startStr);const end = parseDateStr(endStr);if (!dateLessThanOrEqualTo(start, end)) return [0, 0, []];let totalInterest = 0, totalDays = 0, details = [];if (sixMonthPeriod) {let current = { ...start };while (dateLessThanOrEqualTo(current, end) || (current.y === end.y && current.m === end.m && current.d <= end.d)) {const y = current.y;const isFirstHalf = current.m < 6;const rateMonth = isFirstHalf ? 0 : 6;const periodStart = { ...current };const periodEndMonth = isFirstHalf ? 5 : 11;const periodEndDay = daysInMonth(y, periodEndMonth);const periodEndStr = `${y}-${String(periodEndMonth + 1).padStart(2, "0")}-${String(periodEndDay).padStart(2, "0")}`;const periodEnd = dateLessThan(end, parseDateStr(periodEndStr)) ? end : parseDateStr(periodEndStr);const daysDelayed = daysBetweenDates(periodStart, periodEnd);const rate = getRateForDateObj({ y, m: rateMonth });const interest = (amount * rate * daysDelayed) / 36000;const roundedInterest = +interest.toFixed(2);if (daysDelayed > 0) {totalDays += daysDelayed;totalInterest += roundedInterest;details.push({period: `${formatDate(periodStart)} - ${formatDate(periodEnd)}`,rate,days: daysDelayed,interest: roundedInterest});}current = nextHalfYear(current);if (!dateLessThan(current, end) && !(current.y === end.y && current.m === end.m && current.d <= end.d)) break;}} else {let current = { ...start };while (dateLessThanOrEqualTo(current, end) || (current.y === end.y && current.m === end.m && current.d <= end.d)) {const y = current.y, m = current.m;const monthStart = { y, m, d: current.d };const monthEndDay = daysInMonth(y, m);const monthEnd = (current.y === end.y && current.m === end.m) ? end : { y, m, d: monthEndDay };const daysDelayed = daysBetweenDates(monthStart, monthEnd);const rate = getRateForDateObj({ y, m });const interest = (amount * rate * daysDelayed) / 36000;const roundedInterest = +interest.toFixed(2);totalDays += daysDelayed;totalInterest += roundedInterest;details.push({period: formatMonth(y, m),rate,days: daysDelayed,interest: roundedInterest});current = nextMonth(current);if (!dateLessThan(current, end) && !(current.y === end.y && current.m === end.m && current.d <= end.d)) break;}}return [totalInterest.toFixed(2), totalDays, details];}const periodsContainer = document.getElementById("periodsContainer");const addPeriodBtn = document.getElementById("addPeriodBtn");const calculateAllBtn = document.getElementById("calculateAllBtn");const clearAllBtn = document.getElementById("clearAllBtn");const errorDiv = document.getElementById("error");const resultDiv = document.getElementById("result");function addPeriod(amount = "", startDate = "") {const div = document.createElement("div");div.classList.add("period-row");const amountInput = document.createElement("input");amountInput.type = "number";amountInput.placeholder = "Сума";amountInput.min = "0";amountInput.step = "0.01";amountInput.value = amount;amountInput.required = true;const dateInput = document.createElement("input");dateInput.type = "text";dateInput.placeholder = "dd/mm/yyyy";dateInput.value = startDate;dateInput.required = true;const deleteBtn = document.createElement("button");deleteBtn.textContent = "×";deleteBtn.classList.add("delete-period");deleteBtn.title = "Премахни този период";deleteBtn.onclick = () => div.remove();div.appendChild(amountInput);div.appendChild(dateInput);div.appendChild(deleteBtn);periodsContainer.appendChild(div);}addPeriodBtn.onclick = () => addPeriod();clearAllBtn.onclick = () => {periodsContainer.innerHTML = "";resultDiv.innerHTML = "";errorDiv.textContent = "";document.getElementById("endDate").value = "";document.getElementById("sixMonthPeriod").checked = false;addPeriod();};calculateAllBtn.onclick = () => {errorDiv.textContent = "";resultDiv.innerHTML = "";const endDateStr = document.getElementById("endDate").value.trim();const sixMonth = document.getElementById("sixMonthPeriod").checked;if (!isValidDateFormat(endDateStr)) {errorDiv.textContent = "Моля, въведете валидна крайна дата във формат dd/mm/yyyy.";return;}const periodElements = [...periodsContainer.querySelectorAll(".period-row")];if (periodElements.length === 0) {errorDiv.textContent = "Моля, добавете поне един период.";return;}let allValid = true;let resultsHTML = "";let grandTotalInterest = 0;let grandTotalDays = 0;periodElements.forEach((periodDiv, i) => {if (!allValid) return;const amountInput = periodDiv.querySelector("input[type=number]");const dateInput = periodDiv.querySelector("input[type=text]");const amountVal = parseFloat(amountInput.value);const startDateVal = dateInput.value.trim();if (isNaN(amountVal) || amountVal <= 0) {errorDiv.textContent = `Период ${i + 1}: Моля, въведете валидна сума по-голяма от 0.`;allValid = false;return;}if (!isValidDateFormat(startDateVal)) {errorDiv.textContent = `Период ${i + 1}: Моля, въведете валидна начална дата във формат dd/mm/yyyy.`;allValid = false;return;}const startISO = parseDateFromDDMMYYYY(startDateVal);const endISO = parseDateFromDDMMYYYY(endDateStr);if (startISO > endISO) {errorDiv.textContent = `Период ${i + 1}: Началната дата не може да е след крайната дата.`;allValid = false;return;}const [totalInterest, totalDays, details] = calculateInterestDetailed(amountVal, startISO, endISO, sixMonth);grandTotalInterest += parseFloat(totalInterest);grandTotalDays += totalDays;let tableHTML = `<h3>Период ${i + 1} - Сума: ${amountVal.toFixed(2)} лв., Начална дата: ${startDateVal}</h3>`;tableHTML += `<table><thead><tr><th>Период</th><th>Лихвен процент (%)</th><th>Дни</th><th>Лихва (лв.)</th></tr></thead><tbody>`;details.forEach(row => {tableHTML += `<tr><td>${row.period}</td><td>${row.rate.toFixed(2)}</td><td>${row.days}</td><td>${row.interest.toFixed(2)}</td></tr>`;});tableHTML += `</tbody></table>`;tableHTML += `<p><b>Общо лихва:</b> ${totalInterest} лв. за ${totalDays} дни</p>`;resultsHTML += tableHTML;});if (allValid) {resultsHTML += `<h2>Обща сума и дни за всички периоди</h2><table><thead><tr><th>Обща лихва (лв.)</th><th>Общо дни</th></tr></thead><tbody><tr><td>${grandTotalInterest.toFixed(2)}</td><td>${grandTotalDays}</td></tr></tbody></table>`;resultDiv.innerHTML = resultsHTML;}};function addDateMask(input) {input.addEventListener('input', function (e) {let value = e.target.value.replace(/[^0-9]/g, '');if (value.length >= 2) value = value.slice(0, 2) + '/' + value.slice(2);if (value.length >= 5) value = value.slice(0, 5) + '/' + value.slice(5);if (value.length > 10) value = value.slice(0, 10);e.target.value = value;});}function addPeriod(amount = "", startDate = "") {const div = document.createElement("div");div.classList.add("period-row");const amountLabel = document.createElement("label");amountLabel.textContent = "Сума:";amountLabel.style.marginRight = "10px";const amountInput = document.createElement("input");amountInput.type = "number";amountInput.placeholder = "Сума";amountInput.min = "0";amountInput.step = "0.01";amountInput.value = amount;amountInput.required = true;const dateLabel = document.createElement("label");dateLabel.textContent = "Начален период:";dateLabel.style.marginLeft = "20px";dateLabel.style.marginRight = "10px";const dateInput = document.createElement("input");dateInput.type = "text";dateInput.placeholder = "(dd/mm/yyyy)";dateInput.value = startDate;dateInput.required = true;const deleteBtn = document.createElement("button");deleteBtn.textContent = "×";deleteBtn.classList.add("delete-period");deleteBtn.title = "Премахни този период";deleteBtn.onclick = () => div.remove();div.appendChild(amountLabel);div.appendChild(amountInput);div.appendChild(dateLabel);div.appendChild(dateInput);div.appendChild(deleteBtn);periodsContainer.appendChild(div);addDateMask(dateInput);}addDateMask(document.getElementById('endDate'));addPeriod();</script></body></html>
